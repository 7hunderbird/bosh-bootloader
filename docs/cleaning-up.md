= Cleaning up

In addition to creating resources for deploying BOSH, bbl has two subcommands for assisting you in cleaning up an environment after you are done with it: `bbl down` and `bbl cleanup-leftovers`

== bbl down
If you have the state file for a working environment, then bbl will destroy everything it has created. As a safety precaution, BBL will not delete the environment if there are running VMs deployed by the BOSH director

```

```

== bbl cleanup-leftovers
Sometimes, `bbl down` isn't enough to do the job. Perhaps you are in one of these situations:
* bbl down failed during deletion and lost enough information to 
* The statefile is on a computer that you no longer have access to
* You created some resources outside outside of BBL but are sure you want to nuke them
* You are running BBL's integration tests and they failed, leaving a half-created environment

To assist with these situations, we have incorporated the CLI utility [leftovers](https://github.com/genevieve/leftovers) as a subcommand in bbl. You can think of `bbl cleanup-leftovers` as kind of like `bbl down --force`, however, `cleanup-leftovers` doesn't care if you have a state file at all, it will delete resources according to a filter. The filter is very important! If `--filter` is omitted, BBL will begin to delete *ALL* of your IaaS account's resources.

For example, if you had a bbl environment with a name autogenerated by bbl you could supply part of the name to delete it:
```
export BBL_AWS_SECRET_ACCESS_KEY=foo
export BBL_AWS_ACCESS_KEY_ID=bar
bbl cleanup-leftovers --filter malawi --iaas aws
```

This will begin to delete each resource with a name or tag matching "malawi", confirming each one before deletion. Use caution with your filters, because you may have more than one environment with the same "Lake Name". To delete all resources with that name without needing to confirming each one individually use `--no-confim`:
```
bbl cleanup-leftovers --filter malawi --iaas aws --no-confirm
```

`bbl cleanup-leftovers` will do the best it can to delete in an order such that all resources can be deleted without dependency errors. However, running cleanup-leftovers repeatedly may be enough to resolve dependency errors.
