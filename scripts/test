#!/bin/bash -eu

ROOT_DIRECTORY="$( cd "$( dirname "${BASH_SOURCE[0]}" )/.." && pwd )"

function main() {
	pushd "${ROOT_DIRECTORY}" > /dev/null
	  if [[ -n "${@}" ]]; then
		  go test -v "${@}"
	  else
      find . \( -path ./vendor -o -path ./.git \) -prune -o -name "*.go" -print0 | xargs -0 -n1 dirname | sort --unique | xargs go test -v
	  fi
	popd > /dev/null
}

main "${@:-""}"
